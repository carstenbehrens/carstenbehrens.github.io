{"hash":"978865659d06e5628677dcfb830940a89565af21","data":{"post":{"title":"How DOM size can impact performance","date":"June 9, 2020","content":"<p>If you ever used Lighthouse on a large news site like you will notice that most large\nnews sites have more than 2000 DOM nodes.</p>\n<p>Here are some examples:</p>\n<table>\n<thead>\n<tr>\n<th>Website</th>\n<th>Dom Nodes</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>latimes.com</td>\n<td>2292</td>\n</tr>\n<tr>\n<td>washingtonpost.com</td>\n<td>3056</td>\n</tr>\n<tr>\n<td>spiegel.de</td>\n<td>5441</td>\n</tr>\n</tbody>\n</table>\n<p>The Lighthouse test also suggests that a large DOM size has an impact on performance.\nIt names specifically style calculations and layout reflows.</p>\n<p><strong>But do I still need to care if my page doesn't change once it is rendered?</strong></p>\n<h2 id=\"the-setup\"><a href=\"#the-setup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>THE SETUP</h2>\n<p>For this test, I created a simple bash script that lets me create an HTML file with and duplicate the body X times.</p>\n<p>I used <a href=\"https://blackrockdigital.github.io/startbootstrap-business-frontpage/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this</a> bootstrap template for this test - out of the box it got a score of 100 on the Lighthouse performance test. It also has CSS styles that are not overly complex or simple.</p>\n<p><strong>This is important because the CSS rules will affect the test results immensely.</strong></p>\n<p>I will use Github Pages to serve the HTML files and then test them with Lighthouse.</p>\n<h2 id=\"the-test\"><a href=\"#the-test\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>THE TEST</h2>\n<p>I will run each test three times to iron out some variance.\nAll tests will be done using the emulated mobile device in Lighthouse.</p>\n<p>The results:</p>\n<table>\n<thead>\n<tr>\n<th>DOM Elements</th>\n<th>Style &#x26; Layout</th>\n<th>Rendering</th>\n<th>Parse HTML &#x26; CSS</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>3550</td>\n<td>537 ms</td>\n<td>109 ms</td>\n<td>143 ms</td>\n</tr>\n<tr>\n<td>7100</td>\n<td>511 ms</td>\n<td>182 ms</td>\n<td>134 ms</td>\n</tr>\n<tr>\n<td>21300</td>\n<td>1330 ms</td>\n<td>639 ms</td>\n<td>369 ms</td>\n</tr>\n<tr>\n<td>28400</td>\n<td>1858 ms</td>\n<td>967 ms</td>\n<td>500 ms</td>\n</tr>\n</tbody>\n</table>\n<p>The overall performance score drops from 100 to 99 somewhere between 7100 and 21300 DOM elements.</p>\n<p>This is happening because the \"First CPU Idle\" starts to go up as the DOM elements increase - from 1.1s at 3550 DOM elements to 2.4 at 28400 DOM elements.</p>\n<p>I also suspected that having this many DOM elements will affect scrolling.</p>\n<p>That's why I did some quick tests using the performance tab in Chrome with 6x CPU slowdown.</p>\n<p><strong>3550 Elements:</strong>\n<img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1030 123' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-c03875249f207350f716f974397e252b'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-c03875249f207350f716f974397e252b)' width='1030' height='123' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAICAIAAADGAG6IAAAACXBIWXMAAAxOAAAMTgF/d4wjAAAEQ0lEQVQ4yz2UyY7dRBSG7/MAaxYIFqyQ2PEYPAQvAMoCEQkhpOwARSBI0t10urNCSZSkJ9/Bc5WnGlwu12D7errp7nRTvreTo6PyOZ///7dUC89ub29vbm7MmRMegTQn5c27aTX19u2l64A0Ieum25Hr63dhkMQREoX6IKtUA8IkTfDYj7fvC4I0hhmj5Yf8kkvfgzhjY7/Zaa4urwyZ0ri%2bvQu7zRIS%2bFFOed8OOzIOmzCII5CVXH1Io5h5HkwzPJs8bRw2bli7Qe34lRPWHmg8uPbNGZi1cg00c7QODJxIbYh9p1l7YeNtNbbhhsDGGCfZlKYn40455Rs4cXeKau7ygy0HjXv3xXrKB7UPaz/pwrgFUWPEgckEtRe34baBsUeNf/XucsYGmo4h2kC0ifAmQlMDs2YDRGP0Hm7nEd7Jtjwzq9EMW8sI8fY0nQ4g262Td8ox6yQepyi8M24g2SQ7skvORrCVAUPSIXQba1Wd2dW5U587zYVTm7bs%2bsKuz5zpPHe0ZWuLdmh2eXXN6cBQL9jUsuhw1LBsqOVYslawTZ52DLWS96rsOekkG0TRl7Qu8zaFMvRYxTeVGBTr83Stin6tN7oYBO007yJHc9Jq3tdyo7hxdaoYOWk47lwHCWbWoVZDVQ4FboxM5n0j3hJSPHn178Hro6dnR0%2beP9t/eWyGpycHh28O914cH7x5uv/66HC1d%2bTsH7h/z26ub5AvwlWeBgwuymCFAicDDkk94TtJ6ODEJ/48i4MMh0W0LIzSwMDOElu4TnJmW8DhwCndFVvZievQLFH%2bUjmW8FfCOik8h9orHK6kvWDLZeYu2XwZz5fpK/tiscDWPPM96rl0/poDvwxc7iwK32Unlm%2bdkYVFTi/gxTxeLehiFVlWYp2TCyuzlqkXJ3GeJRrM/jphT%2bZibyEeW2J/KfcX4tGFeDwXj6zykSX/seSfZ%2bKPU/Hbifz9VP5tGaU8XMljWx6v%2bH%2beOINqmQpABOICMc6lFLJUWjBOWUFJjhElpVKlkoUQrCxzqblSstLrpqlqXTeVrrSxVLVSWkolVDUlmJicEc5ZwZnJyXNqCmNEaGaehCCMzIZRimef3Ks%2b/kF/9L3%2b9Ef12X39%2bU/6i/vqy5/1V7/or39V3zyQ3z5U3%2b3Je8/4gxfy4RtxYPFji54G3E5kgAREJUClF%2bdBQtNcYlZGiPkxRbmIcAmzYvqxFQozhfKS0DzJaJLhNENplkVxDCNT0wmAaQhh5AXQD6DrAzMEIPJBFIQwCKMAQD8EIYwDEPth7IXQ8UPTs%2bdh8yJsXsI2YENA1z7SSLSFUOaGhr7t22a9bse%2b24yduTJDutagph/Gbhjbfup%2bfLs2uOsN7PvezMZjXFKbq5Ul59P9EUIJNlUwljNGKMsIywuRc8lKLVRdCG0%2bau6fCc2FNq9wXlDGSV5gynaNSG6aTHOOzYxphsj/CdRJzMmJmhoAAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"1030\" alt=\"diagram\" data-srcset=\"/assets/static/3550_scroll.82a2fbd.1e08001443ee5a9082bdbeee6eae6c30.png 480w, /assets/static/3550_scroll.241278c.1e08001443ee5a9082bdbeee6eae6c30.png 1030w\" data-sizes=\"(max-width: 1030px) 100vw, 1030px\" data-src=\"/assets/static/3550_scroll.241278c.1e08001443ee5a9082bdbeee6eae6c30.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/3550_scroll.241278c.1e08001443ee5a9082bdbeee6eae6c30.png\" width=\"1030\" alt=\"diagram\"></noscript></p>\n<p>3550 DOM elements, still smooth 60 FPS.</p>\n<p><strong>28400 Elements:</strong>\n<img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 940 127' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-01e18c3d4e626231dc00b6ea21ce06ca'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-01e18c3d4e626231dc00b6ea21ce06ca)' width='940' height='127' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAJCAIAAAANXL0tAAAACXBIWXMAAA5NAAAOdQFRStTyAAAFpElEQVQ4yyVV2XPbxhnn/5U/om996PSpfen0qa3TpqknvWynTuwck6R2aUuJosSOHYeyKkvRZVI%2bdEaidZAiCIEAFtjFXsACWIAECJASu5r%2bZo9vvmt/O9/Ot5UyH56PxlEYaqfdM8NghI3KsswLpXSB22qdAgCSSJZFcV6O4ig%2bbXW0rg4dWBSFcrwYjQnGp23NME0RhCOlzfM8yyzTbrU6Rq%2bXSFmqjKNSSnl03OoZpuM4o2FZlMXF%2bAI4zslRCwCHEqKOKIfDYTZstzuG3lNkBmlfBY7Hil7caXf0rgEhGmZZUQxVRuii4%2bOTSu6a/ZCMCXe1Zt%2bG5Oxokuapo4/CUHRbzDFT02ZAm3ARwe4kTFF7X7qQdg7zclBORv00yC3g2u1sOGYhOg/EhPCJHKQ9I3CsgYPHEE8UytGFkEI/xVanb4GY2UoX536GMGrtRwQXPTCJ%2byWCEbFS4EHtILHdCGjnk8lwnCec%2bq1jYmk59i%2bgNylGxWTkc9Q33cqZbOnJCSvcTtLkJWxHl2snOnIGei9t25nGSrc7aOIcHImfgpHXkW9wYZ0lJyA/g7mtJYfKpJT%2bOTqVh2QIeO6pDHa/aw068Zj5BfJHmA2RklFma%2bkhKx0tOaCl24qatATd5Ngr7GBIaH4Z1YnfiBFuxweshJps4tK28y4YakDxGbTS81Dk1C89s6%2bZWVue84qNwMmBv/lKd6DfWNc84dWXAOH%2bZh0BF7/Zxbs7%2blYDb293eSherBs8DOpLroPw1oZ7qpuGHuzta4gEGysm5WJtwfY4ebEGDKentUV9Wd/Z1l9vWNDjTx612s6xZcSNle5JE9dXDB6zjVXLwubeK3rSsg6b%2bPDA7emisdoLouhlQ19bbS3X7L1tY7kGugY408T3D9ubemO9frrbbG1saM9/7FW%2bfPp0btq%2bU12v1farN/TFxuZX/%2bDLz3dnb9LHS2vz90m12rhzzfj6zvF646h63VpobHx9nT5YXHhwm8x8V5//Ek3f21n%2brz5902q8Ppj%2bK19Y3Jn9F3n0bPXHWXb378b9G%2bY3t8HrJefW9a272zeePxBffLRT/Wxv5gPz2fqLe/8E3zfm5z5Nv53af/If8HDmYLmmT93urK4czXxofvzvha%2buRvemV%2b9eRd/V1he/ATduPfug8advPwGz9/emroOZm3ZFRG7ih3GMk9BPg1hwPAiSQDgDPwljkIeyH9OBEDIIYp8pBxaAhCc0ABGNfUFCKn3OOQkCHnrUFWRAuFL2mU99nFIaejjAOELExySygx5GMaLYo4ySCFFCSQgZ5GgAPeKh0CWeh32PcmXyoHQopF4KuEOxdCkiJETcc4Xt0wHilNOUsaTyxxr7fY38eZ6985RemfOuLrB3F/DbNXplnlz5wf/NI/zbx/R3NfKHOfLOPP3LAn13nr%2b3iK8tsb8t4veX2a018uEK%2bWgNf94gn9VZ9RWeeknvvvTuNPDsFnqyi581vUYbb3XIjub1bOJhCKDnQA9AFyK1ItdTBJnheABhSCjmPqK8BxliXL1MCxHmhyzgPvcpUw2PqOfrItXJnJ5pGMZZ5a1q/lZ1%2bLPZ7OcP8188Ln75OPvVD/mv54ZvL2bvrQ2u1fNPX6ZTu/2HzfTJYbLUTp9ryaYe/WRGJ3Dg%2bAMDSx2GJo4tEju877AEMGlT2bZID0skMhSkkMU0TH058ALJo34gMyWHSR6mmUz7cZL6Qci44ij8QHBfEeUIE6r4UqoqojqsAvYUb09d2nbUTlTFHEgAxBVIhQiFCAIZR4mMhE/TWBRZmgQ4DclQ0iKL%2b2mYSKFsyh5HyjsKo0iEkUyiIIzVUAjE/2XldzmoHyaJVJ%2bAQhTLWMokSUUUXwYGiiL1EAKXsG3Lch0HQQVXQQnKxNglbazmZR0owtT1GOUBZgEkvku4uoP6PWzg/A%2bTIsuly2ENhwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"940\" alt=\"diagram\" data-srcset=\"/assets/static/28400_scroll.82a2fbd.eeef1e31f1c54760e1e68338a7c58336.png 480w, /assets/static/28400_scroll.7389f3c.eeef1e31f1c54760e1e68338a7c58336.png 940w\" data-sizes=\"(max-width: 940px) 100vw, 940px\" data-src=\"/assets/static/28400_scroll.7389f3c.eeef1e31f1c54760e1e68338a7c58336.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/28400_scroll.7389f3c.eeef1e31f1c54760e1e68338a7c58336.png\" width=\"940\" alt=\"diagram\"></noscript></p>\n<p>You can see that FPS drop a lot - getting as low as 9 FPS - when you have 28.000 DOM elements.\nYou can also see that the main thread is very busy rendering.</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>CONCLUSION</h2>\n<p>After doing all the tests I think it's fair to say that if you don't have any dynamic (adding/removing DOM elements/classes) content on your website you should not worry about a DOM that is too big. Anything under 5000 should be totally fine.</p>\n<p>Now obviously this is highly dependent on the complexity of your CSS rules. The more complex your CSS rules are, the more you have to watch your DOM size.</p>\n<p>On the other hand, if you have a dynamic site, you should about DOM Size and you should also try to keep your CSS selectors as simple as possible.</p>\n<p>Of course, the goal should always be to create the best possible experience for our users, but if you have limited time you should worry about other stuff first.</p>\n<p><strong>Keep in mind that this conclusion only applies if your site doesn't change after it is initially rendered!</strong></p>\n","tags":[{"title":"Frontend","path":"/tag/Frontend/"}]}},"context":{}}